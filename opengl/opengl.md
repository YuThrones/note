# opengl

## opengl是什么？
opengl本质上是一种规范，其代码实现是由GPU制造商提供的。跟在windows使用的direct3d相比，拥有跨平台的优势。

## GLFW
GLFW是一个opengl实现的库，可以用来学习opengl。在`glfw.org` 下载源码或者二进制文件，然后在项目中添加include和link路径就行。

## id
在opengl中对象生成时会获得一个unsigned int类型的id，通过这个id指定对象，生成时自己传入指针来写入。

## 大致理解
opengl的绘制大体有选择缓冲区，修改缓冲区数据，通知GPU使用缓冲区和着色器绘制等。还需要关注索引缓冲区，定点属性等。opengl是以状态机的方式使用，所以绘制前要做选择缓冲区等步骤。shader可以理解为在gpu执行的程序。可以去 `docs.GL`查看详细文档。

## 着色器
着色器有两种，顶点着色器和片段着色器。当发出DrawCall命令的时候，会依次调用顶点着色器和片段着色器，然后显示画面。顶点着色器是计算顶点的数据，片段着色器也叫像素着色器，是计算三角形中所有像素的数据，如果三角形很大，会调用很多次，因此片段着色器的计算代价比顶点着色器高很多，优化时要尽量把计算放在顶点着色器。
opengl以字符的形式吧shader源码传给gpu，我们需要传了之后自己检查shader状态是否正确。

## 索引缓冲区
索引缓冲区的作用是避免一个被多个三角形使用的顶点数据在数据缓冲区重复传递，而只需要使用索引即可，减少显卡内存的消耗。

## 错误处理
可以使用`glGetError`和`glDebugMessageCallback`来处理错误信息。不过一些显示异常，又没有错误的情况，可能只能通过看到代码来解决，这个就是比较麻烦了。

## uniform
`uniform` 可以认为是一个变量用于往gpu投送数据，可以通过在代码中缓存shader的uniform位置来减少获取过程加快速度。

## 顶点数组(VAO)
顶点数组可以存储布局相关的数据，有两种使用办法，一种是使用默认的一个全局的VAO，每次渲染时指定布局等数据，另一种是给每个渲染的几何体一个自己的VAO，每次只绑定VAO和索引缓冲区，以前是使用一个全局VAO更快，现在的话需要在自己环境进行测试。

## material
material可以理解为一个shader加上他所有的uniform。

## blending
blending决定了我们如何将输出颜色和缓冲区中已经存在的颜色结合起来。

## glm
glm是一个opengl可以使用的math库，好处是内存排布按列排布，符合opengl的gpu要求。

## 投影
投影分正交投影和透视投影，透视遵循近大远小，大多数用于3D，正交大多数用于2D。

## model view projection
view matrix有时候称为eye matrix，用来处理相机的位置、旋转等内容。
model matrix 用来表示对象变换相关，包括位移、旋转、缩放等，简称TRS。

## imgui
imgui是一个轻量UI框架，支持opengl和directx，需要的时候可以集成这个方便调试。

## 批量渲染
想要把一个图像渲染在两个不同位置有两个途径：
1. 提供两个不同的顶点缓冲区存储数据，好像渲染两个对象一样。
2. 通过uniform不同来提供不同的投影矩阵，把数据投到两个不同的地方。
第一个方法要用更多显卡内存，第二个方法则会需要更多drawcall，实际使用还是第一个方法性能要好点。