# Linux
## fork
* 一个进程，包括代码、数据和分配给进程的资源。fork（）函数通过系统调用创建一个与原来进程几乎完全相同的进程，也就是两个进程可以做完全相同的事，但如果初始参数或者传入的变量不同，两个进程也可以做不同的事。
  一个进程调用fork（）函数后，系统先给新的进程分配资源，例如存储数据和代码的空间。然后把原来的进程的所有值都复制到新的新进程中，只有少数值与原来的进程的值不同。相当于克隆了一个自己。

* fork调用的一个奇妙之处就是它仅仅被调用一次，却能够返回两次，它可能有三种不同的返回值：
```
1）在父进程中，fork返回新创建子进程的进程ID；
2）在子进程中，fork返回0；
3）如果出现错误，fork返回一个负值；
```

* fork出错可能有两种原因：
1）当前的进程数已经**达到了系统规定的上限**，这时errno的值被设置为**EAGAIN**。
2）**系统内存不足**，这时errno的值被设置为**ENOMEM**。
  创建新进程成功后，系统中出现两个基本完全相同的进程，这两个进程执行没有固定的先后顺序，哪个进程先执行要看系统的进程调度策略。
  每个进程都有一个独特（互不相同）的进程标识符（process ID），可以通过**getpid（）**函数获得，还有一个记录父进程pid的变量，可以通过getppid（）函数获得变量的值。

## 部分shell命令
* a2enmod 开启模块命令
* `who`查看在线用户
* `ps -aux`查看背景执行的程序
* `netstat -a`查看网络联机状态
* fsck为文件系统检查指令，可以修复磁盘
* 使用man或者info命令查看帮助
星期四, 27. 十月 2016 03:20下午 

## 修改dns
* 临时修改
```vi /etc/resolv.conf```
* 永久修改
```
vi /etc/network/interfaces
#添加dns-nameservers 111.111.111.111
```
或者
```
vi /etc/resolvconf/resolv.conf.d/base
#添加nameserver 1.1.1.1
resolvconf -u
```

## 系统常识
* Linux一般将档案可存取的身份分为三个类别，分别是 owner/group/others，丏三种身份各有 read/write/execute 等权限

### 文件档案类型
* 正规档案（regular file），用`ls -al` 显示时第一个字符为 `-`，根据档案内容大致可以分为：
  * 纯文本档（ASCII），用cat即可看到内容
  * 二进制文件（binary），一般可执行文件都是这种格式（scripts，文字性批处理文件不算）
  * 数据格式文件（data），
* 目录（directory）：第一个属性为[d]
* 连接档（link）：第一个属性为[l]
* 设备与装置文件（device），通常集中在 `/dev`目录下，通常分为：
  * 区块（block）设备档：存储数据，提供系统随机存取的接口设备，例如磁盘跟软盘
  * 字符（character）设备文件：亦即是一些串行端口的接口设备，例如键盘，鼠标等。第一个属性为[c]。
* 资料接口文件（sockets）：第一个属性为[s]，最常在 `/var/run`这个目录中看到这种文件类型。
* 数据输送文件（FIFO，pipe）：主要目的在解决多个程序同时存取一个档案所造成的错误问题，第一个属性为[p]。

## Linux目录配置的依据——FHS
* FHS把目录定义为四种交互作用的形态：
  * 可分享的：可以分享给其他系统挂载使用的目录，例如执行文件等
  * 不可分享的：例如仅与自身机器有关的档案
  * 不变的：例如函数库，文件说明文件，系统管理员所管理的主机服务配置文件等。
  * 可变的：经常改变的数据，例如登录文件等。

* FHS针对目录树架构的定义仅有以下三个：
  * /(root，根目录）：与开机系统有关；
  * /usr（unix software resource):与软件安装/执行有关；
  * /var(variable)：与系统运作有关

* FHS定义根目录下应该有这些次目录：
  * `/bin` : /bin放置的是在单人维护模式下还能够被操作的指令，主要有：cat，chmod，chown，date，mv，mkdir，cp，bash等。
  * `/boot` ：主要放置开机会使用到的档案，包括Linux核心档案以及开机选单与开机所需配置文件等。Linux kernel常用的档名为vmlinuz。如果使用grub这个开机管理程序，则会存在 `/boot/grub/` 目录。
  * `/dev` :在Linux系统上，任何装置与接口设备都是以档案的形态存在于这个目录当中。
  * `/etc` :系统主要的配置文件几乎都放置在这个目录。例如人员的账号密码文件等。一般来说这个目录下的各文件属性是可以让一般使用者查阅，但是只有root有权利修改。其中重要的目录有：
    * `/etc/init.d/` 所有服务的预设启动script都是放在这里的。
    * `/etc/xinetd.d/` 这就是所谓的super daemon管理的各项服务的配置文件目录。
    * `/etc/X11/` 与X Windows有关的各种配置文件都在这里，尤其是xorg.conf这个X Server的配置文件。
  * `/home/` 系统默认的用户家目录。家目录有两种代号：
    * `~` :代表目前这个用户的家目录
    * `~dmtsai` :代表dmtsai的家目录
  * `/lib/` :放置开机时会用到的函数库。以及在/bin或/sbin底下的指令会呼叫的函数库而已。尤其重要的是 `/lib/modules/` 这个目录因为该目录会放置核心相关的模块（驱动程序）。
  * `/media/` :放置可移除的装置，例如软盘，光盘等。常见档名有：/media/floppy,/media/cdrom
  * `/mnt/` :一般用于暂时挂载
  * `/opt/` :如果想要自行安装额外的软件，可以安装到这里，不过以前的Linux系统放在/usr/local/下面
  * `/root/` :系统管理员的家目录
  * `/sbin/` :Linux有很多指令用来设定环境，只有root才能够使用，其他用户只能查询。放在/sbin目录下的为开机过程中所需要的，至于服务器软件一般放在 `/usr/sbin/` 中。至于本机自行安装的软件所产生的系统执行文件，则放置在 `/usr/local/sbin/` 中。常见的指令包括：fdisk、fsck、ifconfig、init、mkfs等。
  * `/srv/` :可视为service的缩写，是一些网络服务启动之后， 需要取用的数据目录。常见的如WWW、FTP等。例如WWW服务器需要的网页资料可以放在 `/srv/www/` 里面。
  * `/tmp/` :这个目录的内容可能会在开机时清空。

* 还有一些重要的目录：
  * `/proc` :本身是一个虚拟文件系统，放置的数据都是在内存中的，本身不占任何磁盘空间。
  * `/sys` ：跟/proc类似，也是虚拟文件系统，放置在内存中

* `/usr/`的次目录建议有下面这些：
  * `/usr/X11R6/` :X Window System重要数据所放置的目录。
  * `/usr/bin/` :绝大部分用户可使用指令都放在这里
  * `/usr/include/` :C/C++等程序语言的档头放置处，当用tarball方式安装时会使用里面很多包含档。
  * `/usr/lib/` :包含各应用软件的函数库、目标档案（object file），以及不被一般使用者管用的执行档或脚本。如果使用的是X86_64的Linux系统，可能会有/usr/lib64/目录产生。
  * `/usr/local/` :自行安装下载而非distribution默认提供的软件建议安装到这里。
  * `/usr/sbin/` :非系统正常运作所需要的系统指令。
  * `/usr/share/` :放置共享文件的地方，几乎都是文本文件，常见还有以下次目录：
    * `/usr/share/man/` :联机帮助文件
    * `/usr/share/doc/` :软件杂项的文件说明
    * `/usr/share/zoneinfo/`:与时区有关的市区档案
  * `/usr/src/` :一般原始码建议放到这里，核心原始码建议放置到/usr/src/linux/目录下。

* `/var/` 常见次目录有：
  * `/var/cache/` ：应用程序本身运作过程中会产生的一些暂存档。
  * `/var/lib/` :程序本身执行过程中需要用到的数据文件放置的目录。各个软件应该有各自的目录，例如Mysql应该放在 `/var/lib/mysql` 。
  * `/var/lock/` :某些资源一次只能被一个应用程序使用，如果有两个程序使用可能会产生错误，因为需要上锁。
  * `/var/log/` :登录文件放置的目录。
  * `/var/mail/` :放置个人电子邮件信箱的目录，也被放置到 `/var/spool/mail/`目录中，一般互为链接文件
  * `/var/run/` :某些程序或者服务启动后会把PID放在这个目录下
  * `/var/spool/` :通常放置一些队列数据。

* `uname -r` 查看内核版本， `lsb_release -a`查看发行版本

* 当我们执行一个命令的时候，例如ls，系统会依据PATH的设定去每个PATH定义的目录下搜索文件名为ls的可执行文件，如果在PATH定义的目录中含有多个文件名为ls的可执行文件，那么先被找到的先被执行。

* basename命令获取文件名，dirname命令获取目录名

* 各查看命令：
 * cat 由第一行开始显示档案内容
 * tac 从最后一行开始显示，可以看出 tac 是 cat 癿倒着写！
 * nl 显示癿时候，顺道输出行号！
 * more 一页一页癿显示档案内容
 * less 不 more 类似，但是比 more 更好癿是，他可以往前翻页！
 * head 叧看头几行
 * tail 叧看尾巳几行
 * od 以二迚制癿方式读取档案内容！

* umask指定目前用户在建立档案或者目录时候的默认值，它指的是要去除的权限。
* chattr 设置隐藏属性
* lsattr 查看隐藏属性

* SUID的限制和功能  
  * SUID权限仅对二进制程序有效
  * 执行者对于该程序需要具有x的权限
  * 本权限仅在执行该程序的过程中有效
  * 执行者将具有程序拥有者的权限
  
* SGID类似，当一个目录设定GID后，具有以下功能：  
  * 用户若对此目录具有r与x的权限，该用户能够进入此目录
  * 用户在此目录下的有效群组将会变成该目录的群组
  * 若用户在此目录下具有w的权限，则使用者新建的档案群组与此目录的群组相同
  
* SBIT目前只针对目录有效：
  * 当用户对于此目录具有w，x权限时，也即具有写入的权限时
  * 当用户在该目录下建立档案或目录时，仅有自己与root才有权利删除档案
  
* 如果在代表权限的三个数字面前加上一个数字就代表这几个权限：  
  * 4为SUID
  * 2为SGID
  * 1为SBIT
  
* which用于寻找命令的路径

* 文件名的搜索：一般使用whereis或者locate来搜索，找不到了采用find，因为前两个时利用数据库来搜索，没有真的搜索磁盘，所以比较快
  
* `dumpe2fs` 查询区段与superblock的信息

* `df` ：列出文件系统的整体磁盘使用量；
* `du` ：评估文件系统的磁盘使用量(常用在推估目彔所占容量)

* `mkfs` 格式化文件系统，可以用`-t` 接ext3、ext2,vfat等
* `fsck` 扫描修复磁盘分区

* 常见癿压缩文件案扩展名吧：
```
.Z compress 程序压缩的档案；
.gz gzip 程序压缩的档案；
.bz2 bzip2 程序压缩的档案；
.tar tar 程序打包的数据，并没有压缩过；
.tar.gz tar 程序打包的档案，其中并且经过 gzip 的压缩
.tar.bz2 tar 程序打包的档案，其中并且经过 bzip2 癿压缩
```

* zcat 则可以读取纯文本档被压缩后的压缩文件
* bzip2压缩比强于gzip
* tar -j表示使用bzip2进行压缩

* dump用于备份资料，restore用于还原

* mkisofs:建立映像档  
我们从 FTP 站捉下的 Linux 映像档 (不管是 CD 还是 DVD) 都得要继续刻录成为实体的光盘/DVD后, 才能够进一步的使用,包括安装和更新你的 Linux 啦!同样的道理,你想要利用刻录机将你的数据刻录到 DVD 时, 也得要先将你的数据报成一个映像档,这样才能够写入 DVD 片中。

* cdrecord用于进行刻录

## vim
* 基本上 vi 共分为三种模式,分别是『一般模式』、『编辑模式』不『指令列命令模式』。 这三种模式的作用分别是:
  * 一般模式:  
  以 vi 打开一个档案就直接进入一般模式了(这是默认的模式)。在这个模式中, 你可以使用『上下左右』按键来移劢光标,你可以使用『删除字符』戒『删除整行』来处理档案内容, 也可以使用『复制、贴上』来处理你的文件数据。
  * 编辑模式:  
  在一般模式中可以进行删除、复制、贴上等等的动作,但是却无法编辑文件内容的! 要等到你
按下『i, I, o, O, a, A, r, R』等任何一个字母之后才会进入编辑模式。注意了!通常在 Linux 中,
按下这些按键时,在画面的左下方会出现『 INSERT 或 REPLACE 』的字样,此时才可以进行编
辑。而如果要回到一般模式时, 则必须要按下『Esc』这个按键即可退出编辑模式。
  * 指令列命令模式:  
  在一般模式当中,输入『 : / ? 』三个中的任何一个按钮,就可以将光标移动到最底下那一行。
在这个模式当中, 可以提供你『搜寻资料』的动作,而读取、存盘、大量取代字符、离开 vi 、
显示行号等等的劢作则是在此模式中达成的!

###常用命令
* `：wq` 用于强制写入（在没有权限，但是权限可以改变时）

* `:n1,n2s/word1/word2/g` ：
  n1 和 n2 为数字。在第 n1 和 n2 行之间寻找 word1 这个字符串,并将该字符串取代为 word2 !举例来说,在 100 到 200 行之间搜寻vbird 并取代为 VBIRD 则: `:100,200s/vbird/VBIRD/g`。(常用)
  
* `dd` 删除游标所在的一整列， `ndd` 删除游光标往下n列

* `nyy` 复制光标往下n列

* `u` 复原前一个动作

* `[Ctrl]+r` 重做上一个动作

* `:set nu` 显示行号,设定之后,会在每一行的前缀显示该行的行号

